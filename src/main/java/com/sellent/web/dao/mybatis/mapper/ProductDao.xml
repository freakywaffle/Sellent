<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.sellent.web.dao.ProductDao">
	<select id="getList" resultType="com.sellent.web.entity.ProductView">
		select 
			no, 
			title, 
			thumbnail,
			parent_category parentCategory, 
			sub_category subCategory, 
			writer_id writerId, 
			simple_content simpleContent, 
			detail_content detailContent, 
			price, 
			sell_check sellCheck, 
			duration, 
			edit_cnt editCnt, 
			avg_starpoint avgStarPoint, 
			regdate, 
			approval,
			reviewCnt,
			nickname
 		from productView
	</select>
	<select id="get" parameterType="java.lang.Integer" resultType="com.sellent.web.entity.ProductView">
		select 
			no, 
			title, 
			thumbnail,
			parent_category parentCategory, 
			sub_category subCategory, 
			writer_id writerId, 
			simple_content simpleContent, 
			detail_content detailContent, 
			price, 
			sell_check sellCheck, 
			duration, 
			edit_cnt editCnt, 
			avg_starpoint avgStarPoint, 
			regdate, 
			approval,
			reviewCnt,
			nickname
		from productView where no = #{param1}
	</select>
	<select id="getRecentlyNo" resultType="int">
		select no 
		from (
			select 
				(@rownum:=@rownum+1) as rownum, 
				no 
			from 
				product,
				(SELECT @rownum :=0) AS R 
			order by regdate desc) as sub 
		where rownum = 1;
	</select>
	<insert id="insert" parameterType="com.sellent.web.entity.Product">
		insert into product(
			title, 
			thumbnail,
			parent_category, 
			sub_category, 
			writer_id, 
			simple_content, 
			detail_content, 
			price, 
			sell_check, 
			duration, 
			edit_cnt)
		values(
			#{title}, 
			#{thumbnail},
			#{parentCategory}, 
			#{subCategory}, 
			#{writerId}, 
			#{simpleContent}, 
			#{detailContent}, 
			#{price}, 
			#{sellCheck}, 
			#{duration}, 
			#{editCnt})
	</insert>
	<update id="update" parameterType="com.sellent.web.entity.Product">
		update product set
			title=#{title},
			thumbnail=#{thumbnail},
			parent_category=#{parentCategory}, 
			sub_category=#{subCategory}, 
			writer_id=#{writerId}, 
			simple_content=#{simpleContent}, 
			detail_content=#{detailContent}, 
			price=#{price}, 
			sell_check=#{sellCheck}, 
			duration=#{duration}, 
			edit_cnt=#{editCnt}
		where no=#{no}
	</update>
	<delete id="delete">
		delete from product where no=#{param1}
	</delete>
	<update id="updateStarPointByNo" >
		update product set
			avg_starpoint=#{param2}
		where no=#{param1}
	</update>
	
	<!-- 오버라이드 했을 때 가장 큰놈만 -->
	<select id="getListById" resultType="com.sellent.web.entity.ProductView">
		select * from product 
		where writer_id= #{param1} and sell_check=#{param3}
		order by regdate desc limit #{param2}, 5;
	</select>
	
	<select id="getAllCntById" resultType="int">
		select count(title) from product where writer_id = #{param1} and sell_check=#{param2};
	</select>
	
	
</mapper>